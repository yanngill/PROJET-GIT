<!DOCTYPE html>
<html>
<head>
  <title>Carte interactive - DÃ©barquement</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    #map { height: 100vh; }

    .popup-content { max-width: 250px; }
    img { width: 100%; margin-top: 10px; }
    iframe { width: 100%; height: 150px; margin-top: 10px; }

    .btn-map {
      display: inline-block;
      margin-top: 10px;
      padding: 8px 12px;
      background-color: #00bfff;
      color: black;
      text-decoration: none;
      border-radius: 5px;
      text-align: center;
      font-weight: bold;
    }

    .btn-map i {
      margin-right: 6px;
    }

    .label-icon {
      background: none;
      border: none;
    }

    .label-text {
      font-size: 15px;
      font-weight: bold;
      color: black;
      background-color: rgba(0, 191, 255, 0.8);
      padding: 4px 8px;
      border-radius: 4px;
      white-space: nowrap;
      display: none;
    }

    .label-big {
      font-size: 28px;
      font-weight: bold;
      color: black;
      background-color: rgba(173, 216, 230, 0.7);
      padding: 6px 12px;
      border-radius: 6px;
      white-space: nowrap;
      display: none;
    }

    .zoom-indicator {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1000;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      padding: 6px 10px;
      border-radius: 4px;
      font-weight: bold;
      font-family: sans-serif;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="zoomIndicator" class="zoom-indicator">Zoom : ...</div>

  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([49.37, -0.90], 14);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    map.locate({setView: true, maxZoom: 16});
    map.on('locationfound', function(e) {
      const radius = e.accuracy / 2;
      L.marker(e.latlng).addTo(map).bindPopup("Vous Ãªtes ici").openPopup();
      L.circle(e.latlng, radius).addTo(map);
    });

    // --- Marqueur cliquable : Pointe du Hoc
    const popupPointeHoc = `
      <div class="popup-content">
        <strong>Pointe du Hoc</strong><br>
        Position stratÃ©gique prise d'assaut par les Rangers amÃ©ricains le 6 juin 1944.
        <img src="https://i.imgur.com/1U8cKFq.jpeg" alt="Pointe du Hoc - Avant">
        <iframe src="https://www.youtube.com/embed/zR7TCXmPq9M" frameborder="0" allowfullscreen></iframe>
        <a href="https://www.google.com/maps/dir/?api=1&destination=49.3965263,-0.9881764" target="_blank" class="btn-map">
          ðŸ’  S'y rendre
        </a>
      </div>`;

    const markerPointeHoc = L.marker([49.3965263, -0.9881764], {
      icon: L.icon({
        iconUrl: 'https://unpkg.com/leaflet@1.9.3/dist/images/marker-icon.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowUrl: '',
        shadowSize: [0, 0]
      })
    }).addTo(map).bindPopup(popupPointeHoc);

    // Label Pointe du Hoc
    const labelPointeHoc = L.marker([49.3965263, -0.9881764], {
      icon: L.divIcon({
        className: 'label-icon',
        html: '<span class="label-text">Pointe du Hoc</span>'
      }),
      interactive: false
    }).addTo(map);

    // --- Autres points et labels
    const popupRuquet1 = `
      <div class="popup-content">
        <strong>Le Ruquet â€“ Secteur Est Omaha</strong><br>
        Secteur de dÃ©barquement amÃ©ricain le 6 juin 1944. Ici, les GIâ€™s ont affrontÃ© un feu nourri en tentant de franchir la digue et les hauteurs qui dominent la plage.
        <img src="https://i.imgur.com/P6rq0yq.jpeg" alt="Le Ruquet - Avant">
        <a href="https://www.google.com/maps/dir/?api=1&destination=49.364435,-0.863437" target="_blank" class="btn-map">
          ðŸ’  S'y rendre
        </a>
      </div>`;

    const labelRuquet1 = L.marker([49.364435, -0.863437], {
      icon: L.divIcon({
        className: 'label-icon',
        html: '<span class="label-text">Le Ruquet (Omaha Est)</span>'
      }),
      interactive: false
    }).addTo(map);

    const popupRuquet2 = `
      <div class="popup-content">
        <strong>Mur de soutÃ¨nement â€“ Le Ruquet</strong><br>
        Un des Ã©lÃ©ments dÃ©fensifs encore visibles aujourdâ€™hui.
        <img src="https://i.imgur.com/azReUzU.jpeg" alt="Mur du Ruquet - Avant">
        <a href="https://www.google.com/maps/dir/?api=1&destination=49.364151,-0.864825" target="_blank" class="btn-map">
          ðŸ’  S'y rendre
        </a>
      </div>`;

    const labelRuquet2 = L.marker([49.364151, -0.864825], {
      icon: L.divIcon({
        className: 'label-icon',
        html: '<span class="label-text">Mur du Ruquet</span>'
      }),
      interactive: false
    }).addTo(map);

    const labelOmaha = L.marker([49.375566, -0.851902], {
      icon: L.divIcon({
        className: 'label-icon',
        html: '<span class="label-big">OMAHA BEACH</span>'
      }),
      interactive: false
    }).addTo(map);

    const labelUtah = L.marker([49.426704, -1.170943], {
      icon: L.divIcon({
        className: 'label-icon',
        html: '<span class="label-big">UTAH BEACH</span>'
      }),
      interactive: false
    }).addTo(map);

    const labelZoneHoc = L.marker([49.405119, -0.990373], {
      icon: L.divIcon({
        className: 'label-icon',
        html: '<span class="label-big">POINTE DU HOC</span>'
      }),
      interactive: false
    }).addTo(map);

    const otherMarkers = [
      labelRuquet1,
      labelRuquet2,
      labelOmaha,
      labelUtah,
      labelZoneHoc
    ];

    // --- GÃ©rer les affichages
    function updateLabelVisibility() {
      const zoom = map.getZoom();

      document.querySelectorAll('.label-text').forEach(el => el.style.display = 'none');
      document.querySelectorAll('.label-big').forEach(el => el.style.display = 'none');

      // Label spÃ©cial "Pointe du Hoc" (1 Ã  9)
      const labelHocEl = labelPointeHoc._icon?.parentElement;
      if (labelHocEl) {
        labelHocEl.style.display = (zoom >= 1 && zoom <= 9) ? 'block' : 'none';
      }

      // Marqueur cliquable "Pointe du Hoc" (5 Ã  19)
      const markerHocEl = markerPointeHoc._icon?.parentElement;
      if (markerHocEl) {
        markerHocEl.style.display = (zoom >= 5) ? 'block' : 'none';
      }

      // Autres labels et marqueurs (10+)
      otherMarkers.forEach(marker => {
        const markerEl = marker._icon?.parentElement;
        if (markerEl) {
          markerEl.style.display = (zoom >= 10) ? 'block' : 'none';
        }
      });

      if (zoom >= 10 && zoom <= 14) {
        document.querySelectorAll('.label-big').forEach(el => el.style.display = 'block');
      }

      if (zoom >= 15) {
        document.querySelectorAll('.label-text').forEach(el => el.style.display = 'block');
      }
    }

    function updateZoomDisplay() {
      const currentZoom = map.getZoom();
      document.getElementById('zoomIndicator').innerText = `Zoom : ${currentZoom}`;
    }

    map.on('zoomend', () => {
      updateLabelVisibility();
      updateZoomDisplay();
    });

    updateLabelVisibility();
    updateZoomDisplay();
  </script>
</body>
</html>
